<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Delegado - VoteCorp</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #e74c3c;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 800px;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .logo-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--accent));            
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 4px solid white;
            overflow: hidden;
        }

        .logo-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-text {
            text-align: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--light);
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 14px;
        }
        
        .user-icon {
            width: 32px;
            height: 32px;
            background: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .page-subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
        
        .panel-card {
            background-color: var(--light);
            border-radius: var(--radius);
            padding: 25px;
            border-left: 4px solid var(--secondary);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            width: 24px;
            height: 24px;
            background: var(--secondary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 140px;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-size: 15px;
            background-color: white;
            transition: border 0.3s;
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .message {
            padding: 15px;
            border-radius: var(--radius);
            font-weight: 500;
            margin-top: 20px;
            display: none;
        }
        
        .success {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid rgba(39, 174, 96, 0.3);
            display: block;
        }
        
        .error {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--warning);
            border: 1px solid rgba(231, 76, 60, 0.3);
            display: block;
        }
        
        .info {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
            border: 1px solid rgba(52, 152, 219, 0.3);
            display: block;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 30px;
            padding: 15px;
            background-color: var(--light);
            border-radius: var(--radius);
        }
        
        .status-text {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .active {
            background-color: var(--success);
            animation: pulse 2s infinite;
        }
        
        .inactive {
            background-color: #bdc3c7;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7);
            }
            
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(39, 174, 96, 0);
            }
            
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(39, 174, 96, 0);
            }
        }
        
        .footer {
            margin-top: 30px;
            font-size: 12px;
            color: #95a5a6;
            text-align: center;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .lista-votantes {
            background: var(--light);
            border-radius: 8px;
            padding: 10px;
        }

        .votante-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid var(--secondary);
            font-size: 14px;
        }

        .votante-item:last-child {
            margin-bottom: 0;
        }

        .votante-nombre {
            font-weight: 500;
            color: var(--dark);
        }

        .votante-cedula {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .votantes-group h4 {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @media (max-width: 600px) {
            .stats-panel {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-image">
                <img src="FEOR.jpg" alt="logo-feor">
            </div>
            <div class="logo-text">
                <span>Fondo de Empleados RAMO</span>
            </div>
            <div class="user-info">
                <div class="user-icon">D</div>
                <span>Delegado</span>
            </div>
        </div>
        
        <h1 class="page-title">Panel del Delegado</h1>
        <p class="page-subtitle">Gestione las votaciones y preguntas del sistema</p>
        
        <div class="control-panel">
            <div class="panel-card">
                <h3 class="card-title">
                    <div class="card-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    Control de Votaci√≥n
                </h3>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="abrir()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 12H16M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Abrir Votaci√≥n
                    </button>
                    <button class="btn btn-warning" onclick="cerrar()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Cerrar Votaci√≥n
                    </button>
                </div>
            </div>
            
            <div class="panel-card">
                <h3 class="card-title">
                    <div class="card-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    Gesti√≥n de Preguntas
                </h3>
                <div class="form-group">
                    <label class="form-label">Crear nueva pregunta:</label>
                    <input id="nuevaPregunta" class="form-input" placeholder="Escriba la pregunta...">
                    <button class="btn btn-primary" onclick="crearPregunta()">Agregar</button>
                </div>

                <div class="form-group">
                    <label class="form-label">Seleccione una pregunta:</label>
                    <select id="preguntaSelect" class="form-select">
                        <option value="">Cargando preguntas...</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="activarPregunta()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Activar Pregunta
                </button>
            </div>
        </div>

        <!-- Agrega esto en el control-panel despu√©s de la gesti√≥n de preguntas -->
        <div class="panel-card">
            <h3 class="card-title">
                <div class="card-icon">üë•</div>
                Control de Asistencia
            </h3>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="mostrarAsistencia()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" 
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Ver Asistencia
                </button>
            </div>
            <div id="panelAsistencia" style="display: none; margin-top: 20px;">
                <div id="estadisticasAsistencia"></div>
                <div id="listaAsistencia" style="margin-top: 15px; max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
        
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-value" id="totalPreguntas">0</div>
                <div class="stat-label">Preguntas Totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="votacionesActivas">0</div>
                <div class="stat-label">Votaciones Activas</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="preguntaActual">-</div>
                <div class="stat-label">Pregunta Actual</div>
            </div>
        </div>
        
        <p id="msg" class="message"></p>

        <div class="panel-card">
            <h3 class="card-title">Estad√≠sticas Detalladas</h3>
            <!-- Agrega este bot√≥n temporal para debugging -->
            <div id="estadisticasContainer">
                <p id="estadisticas">Seleccione una pregunta para ver los resultados</p>
            </div>
        </div>
        
        <div class="status-indicator">
            <div class="status-text">
                <div class="status-dot inactive" id="statusDot"></div>
                <span id="statusText">Sistema de votaci√≥n inactivo</span>
            </div>
            <button class="btn" onclick="actualizarEstado()" style="padding: 8px 12px; font-size: 14px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M23 4V10H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1 20V14H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3.51 9C4.01717 7.56678 4.87913 6.2854 6.01547 5.27542C7.1518 4.26543 8.52547 3.55976 10.0083 3.22426C11.4911 2.88875 13.0348 2.93434 14.4952 3.35677C15.9556 3.77921 17.2853 4.56471 18.36 5.64L23 10M1 14L5.64 18.36C6.71475 19.4353 8.04437 20.2208 9.50481 20.6432C10.9652 21.0657 12.5089 21.1112 13.9917 20.7757C15.4745 20.4402 16.8482 19.7346 17.9845 18.7246C19.1209 17.7146 19.9828 16.4332 20.49 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Actualizar
            </button>
        </div>
        
        <div class="footer">
            &copy; 2025 FEOR - Panel de Administraci√≥n
        </div>
    </div>
    <script src="api.js"></script>

    <script>
        
        if (!localStorage.getItem("token")) {
            alert("Acceso denegado");
            window.location.href = "index.html";
        }
        // Funciones originales mejoradas
        async function cargarPreguntas() {
            const msg = document.getElementById("msg");
            msg.innerHTML = "";
            msg.className = "message";
            
            try {
                const res = await obtenerPreguntas();
                const select = document.getElementById("preguntaSelect");

                select.innerHTML = "";

                if (res.preguntas.length === 0) {
                    const op = document.createElement("option");
                    op.textContent = "No hay preguntas registradas";
                    op.disabled = true;
                    select.appendChild(op);
                    return;
                }

                res.preguntas.forEach(p => {
                    const option = document.createElement("option");
                    option.value = p.id;
                    option.textContent = p.texto;
                    select.appendChild(option);
                });

                select.onchange = function() {
                    console.log("Pregunta seleccionada:", this.value);
                    mostrarEstadisticas();
                };
                
                // Actualizar estad√≠sticas
                document.getElementById("totalPreguntas").textContent = res.preguntas.length;

                if (res.preguntas.length > 0) {
                    // Seleccionar la primera pregunta autom√°ticamente
                    select.value = res.preguntas[0].id;
                    // Llamar a mostrarEstadisticas inmediatamente
                    mostrarEstadisticas();
                }
                
            } catch (error) {
                msg.innerHTML = "Error al cargar las preguntas";
                msg.classList.add("error");
                msg.classList.add("error");
            }
        }

        async function abrir() {
            const msg = document.getElementById("msg");
            msg.innerHTML = "";
            msg.className = "message";
            
            try {
                const r = await abrirVotacion();
                msg.innerHTML = r.mensaje;
                msg.classList.add("success");
                actualizarEstado();
            } catch (error) {
                msg.innerHTML = "Error al abrir la votaci√≥n";
                msg.classList.add("error");
            }
        }

        async function cerrar() {
            const msg = document.getElementById("msg");
            msg.innerHTML = "";
            msg.className = "message";

            
            try {
                const r = await cerrarVotacion();
                msg.innerHTML = r.mensaje;
                msg.classList.add("success");
                actualizarEstado();
            } catch (error) {
                msg.innerHTML = "Error al cerrar la votaci√≥n";
                msg.classList.add("error");
            }
        }

        async function activarPregunta() {
            const msg = document.getElementById("msg");
            msg.innerHTML = "";
            msg.className = "message";
            
            const preguntaId = document.getElementById("preguntaSelect").value;
            
            if (!preguntaId) {
                msg.innerHTML = "Por favor, seleccione una pregunta";
                msg.classList.add("error");
                return;
            }
            
            try {
                // Simulaci√≥n de la llamada a la API
                await new Promise(resolve => setTimeout(resolve, 600));
                const res = await activarPreguntaBackend(preguntaId);
                
                if (res.mensaje) {
                    msg.innerHTML = res.mensaje;
                    msg.classList.add("success");
                } else {
                    msg.innerHTML = res.error;
                    msg.classList.add("error");
                }
                actualizarEstado();
            } catch (error) {
                msg.innerHTML = "Error al activar la pregunta";
                msg.classList.add("error");
            }
        }

        async function crearPregunta() {
            const texto = document.getElementById("nuevaPregunta").value;
            const msg = document.getElementById("msg");

            if (!texto.trim()) {
                msg.innerHTML = "La pregunta no puede estar vac√≠a";
                msg.classList.add("error");
                return;
            }

            const res = await crearPreguntaBackend(texto);

            msg.innerHTML = res.mensaje;
            msg.classList.add("success");

            document.getElementById("nuevaPregunta").value = "";
            cargarPreguntas(); // refrescar lista
        }

        async function mostrarEstadisticas() {
            const id = document.getElementById("preguntaSelect").value;
            console.log("üîç Mostrar estad√≠sticas para pregunta ID:", id);
            
            if (!id) {
                document.getElementById("estadisticas").innerHTML = 
                    "‚ùå Por favor, seleccione una pregunta primero";
                return;
            }

            try {
                // Mostrar loading
                document.getElementById("estadisticas").innerHTML = "‚è≥ Cargando estad√≠sticas...";

                console.log("üìä Obteniendo estad√≠sticas generales...");
                // Obtener estad√≠sticas generales
                const est = await obtenerEstadisticas(id);
                console.log("‚úÖ Estad√≠sticas recibidas:", est);

                // Mostrar estad√≠sticas generales
                document.getElementById("estadisticas").innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">Resultados de la Votaci√≥n</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="stat-card" style="background: rgba(39, 174, 96, 0.1); border-left: 4px solid var(--success);">
                                <div class="stat-value" style="color: var(--success);">${est.si}</div>
                                <div class="stat-label">Votos S√ç</div>
                                <div style="font-size: 14px; color: var(--success); margin-top: 5px;">
                                    ${est.porcentaje_si ? est.porcentaje_si.toFixed(1) : 0}%
                                </div>
                            </div>
                            <div class="stat-card" style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid var(--warning);">
                                <div class="stat-value" style="color: var(--warning);">${est.no}</div>
                                <div class="stat-label">Votos NO</div>
                                <div style="font-size: 14px; color: var(--warning); margin-top: 5px;">
                                    ${est.porcentaje_no ? est.porcentaje_no.toFixed(1) : 0}%
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                            <strong>Total de votos:</strong> ${est.total}
                        </div>
                    </div>
                `;

                console.log("üéâ Estad√≠sticas mostradas correctamente");

            } catch (error) {
                console.error("‚ùå Error al cargar detalles:", error);
                document.getElementById("estadisticas").innerHTML = 
                    "‚ùå Error al cargar los detalles: " + (error.message || "Verifica la consola para m√°s detalles");
                document.getElementById("detallesVotantes").style.display = 'none';
            }
        }

        // Funci√≥n para mostrar estad√≠sticas de asistencia
        // Funci√≥n para mostrar estad√≠sticas de asistencia - VERSI√ìN CORREGIDA
        async function mostrarAsistencia() {
            const panel = document.getElementById("panelAsistencia");
            const estadisticasDiv = document.getElementById("estadisticasAsistencia");
            const listaDiv = document.getElementById("listaAsistencia");

            try {
                estadisticasDiv.innerHTML = "‚è≥ Cargando estad√≠sticas de asistencia...";
                listaDiv.innerHTML = "";
                panel.style.display = 'block';

                const response = await fetch(`${API_URL}/vote/estadisticas-asistencia`, {
                    headers: {
                        "Authorization": `Bearer ${getToken()}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log("üìä Datos de asistencia recibidos:", data);

                // Mostrar estad√≠sticas
                estadisticasDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="stat-card" style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid var(--secondary);">
                            <div class="stat-value" style="color: var(--secondary);">${data.total_usuarios}</div>
                            <div class="stat-label">Total Usuarios</div>
                        </div>
                        <div class="stat-card" style="background: rgba(39, 174, 96, 0.1); border-left: 4px solid var(--success);">
                            <div class="stat-value" style="color: var(--success);">${data.asistieron}</div>
                            <div class="stat-label">Asistieron</div>
                            <div style="font-size: 14px; color: var(--success); margin-top: 5px;">
                                ${data.porcentaje_asistencia.toFixed(1)}%
                            </div>
                        </div>
                        <div class="stat-card" style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid var(--warning);">
                            <div class="stat-value" style="color: var(--warning);">${data.faltaron}</div>
                            <div class="stat-label">Faltaron</div>
                            <div style="font-size: 14px; color: var(--warning); margin-top: 5px;">
                                ${data.porcentaje_faltaron.toFixed(1)}%
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: ${data.quorum_alcanzado ? 'rgba(39, 174, 96, 0.1)' : 'rgba(231, 76, 60, 0.1)'}; 
                                border-radius: var(--radius); border: 2px solid ${data.quorum_alcanzado ? 'var(--success)' : 'var(--warning)'};">
                        <h4 style="color: ${data.quorum_alcanzado ? 'var(--success)' : 'var(--warning)'}; margin: 0;">
                            ${data.quorum_alcanzado ? '‚úÖ QU√ìRUM ALCANZADO' : '‚ùå QU√ìRUM NO ALCANZADO'}
                        </h4>
                        <p style="margin: 5px 0 0 0; color: var(--dark);">
                            ${data.quorum_alcanzado ? 
                            `Se alcanz√≥ el qu√≥rum con ${data.porcentaje_asistencia.toFixed(1)}% de asistencia` : 
                            `Se necesita al menos 50% de asistencia. Actual: ${data.porcentaje_asistencia.toFixed(1)}%`}
                        </p>
                    </div>
                `;

                // Mostrar lista de usuarios - CORREGIDO
                if (data.lista_usuarios && data.lista_usuarios.length > 0) {
                    let listaHTML = '<h4 style="margin: 20px 0 10px 0; color: var(--primary);">Lista de Usuarios</h4>';
                    
                    data.lista_usuarios.forEach(usuario => {
                        // Manejar diferentes nombres de columnas para el nombre
                        const nombre = usuario.nombre || 
                                    usuario.usuario || 
                                    usuario.username || 
                                    usuario.email || 
                                    usuario.correo || 
                                    usuario.name || 
                                    `Usuario ${usuario.id}`;
                        
                        // Manejar diferentes nombres de columnas para la c√©dula
                        const cedula = usuario.cedula || 
                                    usuario.documento || 
                                    usuario.dni || 
                                    usuario.identificacion || 
                                    usuario.id_number || 
                                    'N/A';
                        
                        listaHTML += `
                            <div class="votante-item" style="border-left-color: ${usuario.estado === 'Asisti√≥' ? 'var(--success)' : 'var(--warning)'};">
                                <div class="votante-nombre">${nombre}</div>
                                <div class="votante-cedula">Identificaci√≥n: ${cedula}</div>
                                <div style="font-size: 12px; color: ${usuario.estado === 'Asisti√≥' ? 'var(--success)' : 'var(--warning)'}; 
                                        margin-top: 3px; font-weight: 500;">
                                    ${usuario.estado === 'Asisti√≥' ? '‚úÖ Asisti√≥' : '‚ùå Falt√≥'}
                                </div>
                            </div>
                        `;
                    });
                    
                    listaDiv.innerHTML = listaHTML;
                } else {
                    listaDiv.innerHTML = '<div class="votante-item">No hay usuarios registrados en el sistema</div>';
                }

            } catch (error) {
                console.error("Error al cargar asistencia:", error);
                estadisticasDiv.innerHTML = `
                    <div style="color: var(--warning); text-align: center; padding: 20px;">
                        ‚ùå Error al cargar las estad√≠sticas de asistencia: ${error.message}
                    </div>
                `;
            }
        }
        
        async function actualizarEstado() {
            try {
                const estado = await obtenerEstadoSistema();
                
                const statusDot = document.getElementById("statusDot");
                const statusText = document.getElementById("statusText");
                
                if (estado.activa) {
                    statusDot.className = "status-dot active";
                    statusText.textContent = "Sistema de votaci√≥n activo";
                } else {
                    statusDot.className = "status-dot inactive";
                    statusText.textContent = "Sistema de votaci√≥n inactivo";
                }
                
                // Actualizar estad√≠sticas
                document.getElementById("votacionesActivas").textContent = estado.activa ? 1 : 0;
                document.getElementById("preguntaActual").textContent =
                    estado.activa && estado.pregunta ? estado.pregunta.texto : "-";
                
            } catch (error) {
                console.error("Error al actualizar el estado:", error);
            }
        }

        window.onload = function() {
            cargarPreguntas();
            actualizarEstado();
        };
    </script>
</body>
</html>